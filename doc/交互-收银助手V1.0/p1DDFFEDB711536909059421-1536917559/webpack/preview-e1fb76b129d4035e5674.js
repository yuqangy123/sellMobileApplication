(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{195:function(e,t,a){a("j36g"),a("55Il"),e.exports=a("Z3xQ")},KUpD:function(e,t,a){e.exports={"install-page-wrapper":"_2145f6w_gvAx5jbCLSvNm1","install-page":"_1ucR52TRm2uhcZJhUjsxqG"}},Z3xQ:function(e,t,a){"use strict";a.r(t);var n=a("zkrS"),r=(a("KKmY"),a("P3rE"),a("dppN"),a("T7iu"),a("7eYF")),s=a("aqSL"),o=a("lw2U"),c=a("+Cau"),i=a("rbsZ"),l=a("abHt"),p=(a("RJdT"),a("o0o1")),d=a.n(p),u=a("8fIB"),m=a.n(u),w=a("yXPU"),h=a.n(w),f=a("q1tI"),g=a.n(f),v=a("i8i4"),b=a.n(v),k=a("XkTy"),N=a("tajm"),E=a("lwsE"),P=a.n(E),M=a("W8MJ"),x=a.n(M),y=a("a1gu"),S=a.n(y),j=a("Nsbk"),C=a.n(j),I=a("7W2i"),B=a.n(I),_=a("PJYZ"),T=a.n(_),D=a("lSNA"),O=a.n(D),A=a("17x9"),W=a("ldhK"),R=a.n(W),U="/images/sharing/wechat_".concat(window.MBLocale,".png"),q="/images/sharing/ios_".concat(window.MBLocale,".png"),L=function(e){function t(){var e,a;P()(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return a=S()(this,(e=C()(t)).call.apply(e,[this].concat(r))),O()(T()(T()(a)),"handleClick",function(){a.props.onClose()}),a}return B()(t,e),x()(t,[{key:"render",value:function(){var e=this.props.show,t=MB.isWechat(),a=!t&&MB.isIOS(),n=MB.isiPad(),r=!(t||a),s={display:e?"":"none"};return g.a.createElement("div",{className:R.a.covers,style:s,onClick:this.handleClick},t&&g.a.createElement("div",{className:"cover wechat"},g.a.createElement("img",{className:"robot",src:"/images/sharing/robot.png"}),g.a.createElement("img",{className:"tips",src:U}),"s",g.a.createElement("div",{className:"arrow"})),a&&!n&&g.a.createElement("div",{className:"cover ios"},g.a.createElement("img",{className:"robot",src:"/images/sharing/robot.png"}),g.a.createElement("img",{className:"tips",src:q}),g.a.createElement("div",{className:"arrow"})),n&&g.a.createElement("div",{className:"cover ipad"},g.a.createElement("img",{className:"robot",src:"/images/sharing/robot.png"}),g.a.createElement("img",{className:"tips",src:q}),g.a.createElement("div",{className:"arrow"})),r&&g.a.createElement("div",{className:"cover building"},g.a.createElement("div",{className:"tip-wrapper"},g.a.createElement("p",{className:"tip"},I18N.building_apk),g.a.createElement("div",{className:"spinner"}))))}}]),t}(f.PureComponent);L.propTypes={show:A.PropTypes.bool,onClose:A.PropTypes.func};var J=a("KUpD"),K=a.n(J),G=a("UbMB"),Z=a.n(G),F=a("t3Un"),Q=Z.a.bind(K.a),Y=function(){var e=h()(d.a.mark(function e(t){var a,n,r;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return MB.event("移动端: 点击下载 APK","运行页"),e.next=3,Object(F.b)("/app/".concat(t,"/build/apk.json"),null,{method:"PUT"});case 3:return e.next=6,H(5e3);case 6:return e.next=8,Object(F.b)("/app/".concat(t,"/status/apk.json"));case 8:if(a=e.sent,n=a.progress,r=a.link,100===n){e.next=13;break}return e.abrupt("continue",3);case 13:return window.location=r,e.abrupt("return");case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),H=function(e){return new m.a(function(t){return setTimeout(t,e)})},V=function(e,t){MB.event("移动端: 点击下载安卓客户端","运行页");var a=window.location,n=a.hostname,r=a.pathname,s=navigator.userAgent.toLowerCase(),o=document.createElement("iframe");if(document.body.appendChild(o),o.style.cssText="display:none;width=0;height=0",setTimeout(function(){window.location=e},200),console.log("userAgent",s),s.includes("chrome")&&s.includes("android")&&!s.includes("ucbrowser")&&!s.includes("quark")){var c="intent://".concat(n).concat(r,"?password=").concat(t,"#Intent;package=com.mockingbot;scheme=mockingbot;S.browser_fallback_url=").concat(e,";end");o.src=c}else{var i="mockingbot://".concat(n).concat(r,"?password=").concat(t);window.open(i)}},X=function(e,t){MB.event("移动端: 点击下载 iOS 客户端","运行页");var a=window.location,n=a.hostname,r=a.pathname,s="modao://".concat(n).concat(r,"?password=").concat(t);setTimeout(function(){window.location=e},25),window.location=s},z=function(e){function t(){var e;return P()(this,t),e=S()(this,C()(t).call(this)),O()(T()(T()(e)),"handleView",function(t){t.preventDefault(),e.props.loadProject()}),O()(T()(T()(e)),"handleInstall",function(t){t.preventDefault();var a=e.props.project,n=a.accessToken,r=a.userPlan,s=a.exportable;MB.isWechat()?e.setState({isCoverShow:!0}):MB.isiPad()||MB.isIOS()?e.setState({isCoverShow:!0}):s?(e.setState({isCoverShow:!0}),Y(n).then(function(){return e.setState({isCoverShow:!1})}).catch(function(e){})):MB.promptRenew("exportable",{format:"apk",role:"project",plan:r})}),O()(T()(T()(e)),"handleDownload",function(t){var a=e.props.encryptedPassword;MB.isWechat()?e.setState({isCoverShow:!0}):MB.isIOS()?X(t,a):MB.isAndroid()&&V(t,a)}),O()(T()(T()(e)),"handleCloseCover",function(){e.setState({isCoverShow:!1})}),e.state={isCoverShow:!1},e}return B()(t,e),x()(t,[{key:"componentDidMount",value:function(){$("#splash").hide(),$("#workspace").show(),$.timeago.settings.lang=window.MBLocale,$(".timeago").timeago()}},{key:"render",value:function(){var e=this,t=this.props.project,a=t.name,n=t.iconUrl,r=t.updatedAt,s=t.ios_client_url,o=t.android_client_url,c=this.state.isCoverShow,i=MB.isAndroid(),l=i?o:s,p=i?I18N.download_android_apk:I18N.add_to_home_screen;return g.a.createElement("div",{className:Q("install-page-wrapper")},g.a.createElement("div",{className:Q("install-page",{"is-wechat":MB.isWechat()})},g.a.createElement("div",{className:"app-inner"},g.a.createElement("img",{className:"app-icon",src:n}),g.a.createElement("h1",{className:"app-name"},a),g.a.createElement("div",{className:"app-update-time"},g.a.createElement("time",{className:"timeago",dateTime:r}),I18N.update),g.a.createElement("div",{className:"install-btns"},g.a.createElement("a",{className:"install-btn primary",onClick:function(){return e.handleDownload(l)}},I18N.open_in_client),g.a.createElement("a",{className:"install-btn",onClick:this.handleView},I18N.view_app)),g.a.createElement("a",{className:"download-btn",onClick:this.handleInstall},g.a.createElement("span",null,p),g.a.createElement("i",{className:"fa fa-angle-right"}))),g.a.createElement(L,{show:c,onClose:this.handleCloseCover})))}}]),t}(f.PureComponent);O()(z,"propTypes",{project:A.PropTypes.object,loadProject:A.PropTypes.func,encryptedPassword:A.PropTypes.string});var ee=window,te=ee.$,ae=ee.MB,ne=ee.MBLocale,re=ee.md5,se=ee.SharingRunner,oe=ae.localStorageDelegate,ce=function(){return!!window.MBData},ie=/\/embed\b/.test(location.pathname);ae.f.inSharing=!0;var le=function(e,t){return t||new URLSearchParams(location.search).get("password")||oe.getItem("".concat(e,"_pwd"))};ae.load=function(){var e=h()(d.a.mark(function e(t){var a,n,r,s,o,c,i,l;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.token,n=t.isPasswordRequired,r=t.encryptedPassword,s=t.installerProject,ae.webpackInterface.renderPreviewAlert(),o=le(a,r),c=!ae.isStandAlone()&&!ae.isInApp&&ae.isMobile()&&!ce()&&!ie,ae.supportedBrowser()){e.next=8;break}return te("#splash").hide(),te("#loading").hide(),e.abrupt("return");case 8:if(i=ae.isMac()?"mac":ae.isWindows()?"windows":"other-os",te("html").addClass(i),(ae.isStandAlone()||ae.isIOSClient())&&te("html").addClass("is-full-screen"),!c){e.next=17;break}return e.next=14,de({token:a,isPasswordRequired:n,savedEncryptedPassword:o,shouldGetData:!1});case 14:return te("#loading").hide(),e.next=17,new m.a(function(e){b.a.render(g.a.createElement(z,{project:s,loadProject:e,encryptedPassword:le(a,r)}),document.getElementById("workspace"))});case 17:return e.next=19,de({token:a,isPasswordRequired:n,savedEncryptedPassword:le(a,r)});case 19:return l=e.sent,e.abrupt("return",ce()?we(l):l?me(l):null);case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();var pe=function(){var e=h()(d.a.mark(function e(t){var a,n,r,s,o,c,i;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.token,n=t.encryptedPassword,r=t.shouldGetData,s=void 0===r||r,o=window.MBData,!ce()){e.next=6;break}if(!o.project.password||n===o.project.password){e.next=5;break}throw new Error("Wrong password!");case 5:return e.abrupt("return",o);case 6:if(s){e.next=14;break}return e.next=9,fetch("/app/".concat(a,"/checkpassword?password=").concat(n));case 9:if(c=e.sent,c.ok){e.next=13;break}throw new Error("Wrong password!");case 13:return e.abrupt("return",!0);case 14:return i="/app/".concat(a,".json?").concat((new Date).valueOf()).concat(n?"&password=".concat(n):""),e.abrupt("return",ue(i));case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),de=function(){var e=h()(d.a.mark(function e(t){var a,n,r,s,o,c,i;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.token,n=t.isPasswordRequired,r=t.savedEncryptedPassword,s=t.shouldGetData,o=void 0===s||s,e.prev=1,e.next=4,pe({token:a,shouldGetData:o,encryptedPassword:r});case 4:c=e.sent,e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.log("Invalid saved password: ".concat(e.t0,". Will retry with prompt.")),oe.removeItem("".concat(a,"_pwd"));case 11:if(c){e.next=33;break}if(e.prev=12,!n){e.next=25;break}return e.t1=re,e.next=17,Object(k.e)();case 17:return e.t2=e.sent,i=(0,e.t1)(e.t2),e.next=21,pe({token:a,shouldGetData:o,encryptedPassword:i});case 21:c=e.sent,oe.setItem("".concat(a,"_pwd"),i),e.next=26;break;case 25:Object(k.a)({desc:I18N.no_permission_to_app});case 26:e.next=33;break;case 28:return e.prev=28,e.t3=e.catch(12),console.log("Invalid prompt password:",e.t3),setTimeout(function(){return Object(k.a)({desc:n?I18N.invalid_credential:"Failed to load this app."})},320),e.abrupt("return",null);case 33:return e.abrupt("return",c);case 34:case"end":return e.stop()}},e,this,[[1,7],[12,28]])}));return function(t){return e.apply(this,arguments)}}(),ue=function(e){return new m.a(function(t,a){return te.getJSON(e,function(e){return t(e)}).fail(function(e,t,n){return a(n)})})},me=function(e){te(".indicator").css("height","100%"),setTimeout(function(){return he(e)},300)},we=function(e){ae.staticMap=function(){return"images/workspace/staticmap_".concat(ne,".png")},e.project.splash="images/splash.png",e.screens.forEach(function(e){e.bgimage&&(e.bgimage=e.bgimage.replace(/^.+uploads.*?\//,""))}),e.widgets.forEach(function(e){e.image&&(e.image=e.image.replace(/^.+uploads.*?\//,""))}),e.widgetstates.forEach(function(e){e.image&&(e.image=e.image.replace(/^.+uploads.*?\//,""))}),te(".indicator").css("height","100%"),setTimeout(function(){return he(e)},300)},he=function(e){var t=e.project.template?new Template:e.project.combo?new Combo:new Project;t.load(e.project),t.lsave(!1),ae.currentProject=t,Template.refresh(e.templates),Screen.refresh(e.screens),Widget.refreshWidgetAfterDecompress(e.widgets),Link.refresh(e.links),Panel.refresh(e.panels),Screenstate.refresh(e.screenstates),Widgetstate.refreshWidgetstateAfterDecompress(e.widgetstates),Panelstate.refresh(e.panelstates),Collaborator.refresh(e.collaborators),CommentThread.refresh(e.threads),Comment.refresh(e.comments),Team.refresh(e.teams),ae.user=te("#workspace").data("user")||{},ae.isMobile()||Object(N.a)(),(new Image).src=ae.staticMap(),te("title").html(t.name),te("#loading").hide(),!t.validated&&ae.isMobile()&&Object(k.a)({title:I18N.reminder,desc:I18N.fraud_warning,confirmText:I18N.fraud_confirm,isHTML:!0}),ae.checkFA(function(){te(".box").hide(),ae.currentProject=t,ae.webpackInterface.init(),ae.Pusher&&ae.user.id&&"guest"!==ae.webpackInterface.store.getState().model.current.userRole&&ae.Pusher.enableSocketChannel(t.cid),ae.runner=new se(t),ae.runner.render()})};MB.COMPONENTS=l.c;try{n.a.MB.webpackInterface=Object(r.a)(s.a),n.a.MB.setRunnerExtra=o.a,n.a.MB.renewMsg=i.a,n.a.MB.promptRenew=i.c,n.a.MB.messageBucket=Object(c.a)(c.b)}catch(e){console.warn("[UI:Preview] Failed to init:",e.stack||e)}},ldhK:function(e,t,a){e.exports={covers:"_2fva7dqNrMTA3qQj2Sag2u"}}},[[195,1,0,2]]]);
//# sourceMappingURL=preview-e1fb76b129d4035e5674.js.map